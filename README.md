# 書籍レビューアプリ

~~[アプリのデモはこちらから](https://book-review-frontend-pearl.vercel.app)~~

申し訳ございません、こちらの都合で現在は AWS の EC2 を止めてしまったので動かせません。

## アプリの説明

自分の読んだ書籍のレビューを他のユーザーと共有できるアプリです。

## 作成背景

- バックエンドを自分の力で実装して、理解を深めたいと思ったから。

  - このアプリはフロントエンドを実装するというプログラミングスクールからの課題として取り組んだのですが、バックエンドはスクール側が実装してくれていました。そこで、自分でもフロントエンドの実装だけでなくバックエンドの実装をして理解を深めたいと思い作成しました。

- 自分で作っている中で「こうすればもっと使いやすくなるのでは？」と思う部分があったから。

## 工夫点

- フロントエンド

  - ホームページのタイトル一覧、特定の幅まで文字がたどり着いたら末尾を「...」に置き換えるようにして、見やすくしました。

  - トークンが無い、もしくは無効な状態でトークンが必要なページにアクセスするとエラーページを表示させ、ログインを促すようにしました。

  - 書籍の作成画面と更新画面の UI がほとんど同じなので、1 つのコンポーネントに共通化しました。

  - 書籍レビューを新規作成する際にその書籍の商品 URL を自分で入力するようにしていたのですが、これだと悪い人が悪意を持った Web サイトに誘導できてしまうという問題があったので、
    [Google Books APIs](https://developers.google.com/books/docs/v1/using?hl=ja)というものを使用して、入力した書籍のタイトルにヒットして一番上にある書籍データの URL を
    データベースに保存するようにしました

- バックエンド

  - Eloquent やファサードを積極的に使うようにしました。

  - ぺジネーションを実装することで、書籍レビュー一覧取得のレスポンスタイムを軽減しました

  - PHP は動的型付け言語なので、タイプヒンティングや declare(strict_types=1);を書いて、厳格なクラス設計にしました。

  - API が正しく動作しているか確認するテストコードを書きました。

  - メソッドチェーンが長くなってしまった箇所をスコープに移して定義することで可読性を向上しました。

  - レスポンスの json の Unescape 処理をミドルウェアに任せるようにしました。

## 苦労点

- フロントエンド

  - コンポーネントの分け方に困った。

  - CORS の設定につまづいた。

- バックエンド

  - テストケースの書き方に苦労しました。（どの assert を使うか？など）

  - 信頼できる情報にたどり着くまでのプロセスに苦労しました。（最近はドキュメントから調べものをスタートするようにしてる）

  - データベースの設計。（正規化するところはする等）

  - 書籍のレビュワーが書いたコメントなのか判定する処理と、自分が書いたコメントなのか判定する処理の実装に困りました。最終的にはコメントを格納するデータベースにレビュワーが書いたコメントか判定するためのフラグを作成するようにしました。

  - ユーザーがレビューに対するコメントにいいねをした時、そのいいねを押した状態を保持する実装に苦労しました。最終的にはいいねを押した時、データベースにデータを作り、いいねの状態を保持するようにしました。

## 課題

- 認証に使うトークンの有効期限を一日と長めに設定しているので、リフレッシュトークンを使用してトークンを短い期間で再発行できるようにし、流出の際のリスクを減らせるようにする。

- テストコードを書いたが、してほしくない挙動、例えばアクセストークンがない状態でアクセストークンが必要な API にアクセスしたときに 401 エラーが返ってくる等を確認するテストが書けていない。

- ~~書籍の更新の際に初期値が入っているが、その初期値のまま更新を押すと、input タグの中に文字は入っているのに「～を入力して下さい」というエラー文が表示される。~~

- ~~一日の終わりに期限が切れたトークンをデータベースから削除する~~
